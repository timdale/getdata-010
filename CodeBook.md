# Code Book

## Raw Data Collection

The raw data was pulled from the UCI Machine Learning Laboratory.  Details on the data are found at [http://archive.ics.uci.edu/ml/datasets/Human+Activity+Recognition+Using+Smartphones]

The data itself was downloaded from [https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip], decompressed, and _installed in the same working directory as the script_.


## Raw Data Content

The observation data was split up by the provider between a training set and test set, whose data is found in the *test* and *train* subdirectories. 
- *test/Inertial Signals* and *train/Inertial Signals* are not used in this project.
- *test/X_test.txt* and *train/X_train.txt* contain the actual observations.  Each line of these files is a 561-feature vector (i.e., 561 columns of whitespace-separated numeric text, in scientific notation), normalized to -1..1
- *test/subject_test.txt* and *train/subject_train.txt* is a single column of subject IDs.  The observations were made by 30 subjects, with an ID from 1..30.  There is a row corresponding to each row in the respective *X* observation file, thus indicating which subject collected that respective observation.
- *test/y_test.txt* and *train/y_train.txt* is a single column of activity IDs.  Similar to the subject IDs, there is a row corresponding to each row in the respective *X* observation file, thus indicating which activity was being performed for that observation.  See *activity_labels.txt* below.
- *features.txt* is the feature name for each feature in the *X* observation files.  I.e., it contains the names for each column of data in the *X* files.  There are thus 561 names in this file, one for each column of data.
- *features_info.txt* contains the details for each feature, as provided by UCI.  This file is not used in creating the tidy data, but is informative for understanding the data and variable naming.
- *activity_labels.txt* contains the mapping of activity IDs to a meaningful description:
```
        1 WALKING
        2 WALKING_UPSTAIRS
        3 WALKING_DOWNSTAIRS
        4 SITTING
        5 STANDING
        6 LAYING
```

## Tidying the Data

*run_analysis.R* is the script that performs the tidying of the data.  

### Merging the Test and Training Data

1. The observation data is first read from the *X* files and concatentated into a data frame with column names read and applied from *features.txt*.  There are a total of 10299 observations.
2. Likewise the activity IDs are merged from the *y* files, for a total of 10299 activity IDs, each corresponding to the same ordinal observation.
3. Likewise the subject IDs are merged from the *subject* files, for a total of 10299 subject IDs, each corresponding to the same ordinal observation.

Note that all merging is done in order: test, training.


### Thatching 
This project is only concerned with features that contain means or standard deviations.  The pertinent columns will all have names that contain ```-mean()``` or ```-std()```, respectively.  All other columns are dropped from the observation data, leaving 66 columns remaining.

### Preening
The observation column names are next made a little more readable.  This is a simple transformation:
 - All parens ```()``` are removed from the names
 - Names beginning with a single lowercase ```t``` are suffixed with ```time``` (and the ```t``` removed).
 - Names beginning with a single lowercase ```f``` are suffixed with ```freq``` (and the ```f``` removed).
 
### Joining the Subjects, Activities, and Observations
1. The descriptive activities  (e.g., "WALKING", "STANDING") are translated from the activity IDs, and left-pended to each observation, forming a column named "activity".  This makes the data easier for humans to read instead of a numeric ID for the activity.
2. The subject IDs are merged from the test and training sets, and are left-pended to each observation, forming a column named "subjectId".


## The Tidy Data
The resulting tidy data is a data frame of 68 columns.  The first (left-most) column is "subjectId", followed by "activity", followed by the 66 named mean/stddev columns:

```
'data.frame':    10299 obs. of  68 variables:
 $ subjectId                   : int  2 2 2 2 2 2 2 2 2 2 ...
 $ activity                    : Factor w/ 6 levels "LAYING","SITTING",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ timeBodyAcc-mean-X          : num  0.257 0.286 0.275 0.27 0.275 ...
 $ timeBodyAcc-mean-Y          : num  -0.0233 -0.0132 -0.0261 -0.0326 -0.0278 ...
 $ timeBodyAcc-mean-Z          : num  -0.0147 -0.1191 -0.1182 -0.1175 -0.1295 ...
 $ timeBodyAcc-std-X           : num  -0.938 -0.975 -0.994 -0.995 -0.994 ...
 $ timeBodyAcc-std-Y           : num  -0.92 -0.967 -0.97 -0.973 -0.967 ...
 $ timeBodyAcc-std-Z           : num  -0.668 -0.945 -0.963 -0.967 -0.978 ...
 $ timeGravityAcc-mean-X       : num  0.936 0.927 0.93 0.929 0.927 ...
 $ timeGravityAcc-mean-Y       : num  -0.283 -0.289 -0.288 -0.293 -0.303 ...
 $ timeGravityAcc-mean-Z       : num  0.115 0.153 0.146 0.143 0.138 ...
 $ timeGravityAcc-std-X        : num  -0.925 -0.989 -0.996 -0.993 -0.996 ...
 $ timeGravityAcc-std-Y        : num  -0.937 -0.984 -0.988 -0.97 -0.971 ...
 $ timeGravityAcc-std-Z        : num  -0.564 -0.965 -0.982 -0.992 -0.968 ...
 $ timeBodyAccJerk-mean-X      : num  0.072 0.0702 0.0694 0.0749 0.0784 ...
 $ timeBodyAccJerk-mean-Y      : num  0.04575 -0.01788 -0.00491 0.03227 0.02228 ...
 $ timeBodyAccJerk-mean-Z      : num  -0.10604 -0.00172 -0.01367 0.01214 0.00275 ...
 $ timeBodyAccJerk-std-X       : num  -0.907 -0.949 -0.991 -0.991 -0.992 ...
 $ timeBodyAccJerk-std-Y       : num  -0.938 -0.973 -0.971 -0.973 -0.979 ...
 $ timeBodyAccJerk-std-Z       : num  -0.936 -0.978 -0.973 -0.976 -0.987 ...
 $ timeBodyGyro-mean-X         : num  0.11998 -0.00155 -0.04821 -0.05664 -0.05999 ...
 $ timeBodyGyro-mean-Y         : num  -0.0918 -0.1873 -0.1663 -0.126 -0.0847 ...
 $ timeBodyGyro-mean-Z         : num  0.1896 0.1807 0.1542 0.1183 0.0787 ...
 $ timeBodyGyro-std-X          : num  -0.883 -0.926 -0.973 -0.968 -0.975 ...
 $ timeBodyGyro-std-Y          : num  -0.816 -0.93 -0.979 -0.975 -0.978 ...
 $ timeBodyGyro-std-Z          : num  -0.941 -0.968 -0.976 -0.963 -0.968 ...
 $ timeBodyGyroJerk-mean-X     : num  -0.2049 -0.1387 -0.0978 -0.1022 -0.0918 ...
 $ timeBodyGyroJerk-mean-Y     : num  -0.1745 -0.0258 -0.0342 -0.0447 -0.029 ...
 $ timeBodyGyroJerk-mean-Z     : num  -0.0934 -0.0714 -0.06 -0.0534 -0.0612 ...
 $ timeBodyGyroJerk-std-X      : num  -0.901 -0.962 -0.984 -0.984 -0.988 ...
 $ timeBodyGyroJerk-std-Y      : num  -0.911 -0.956 -0.988 -0.99 -0.992 ...
 $ timeBodyGyroJerk-std-Z      : num  -0.939 -0.981 -0.976 -0.981 -0.982 ...
 $ timeBodyAccMag-mean         : num  -0.867 -0.969 -0.976 -0.974 -0.976 ...
 $ timeBodyAccMag-std          : num  -0.705 -0.954 -0.979 -0.977 -0.977 ...
 $ timeGravityAccMag-mean      : num  -0.867 -0.969 -0.976 -0.974 -0.976 ...
 $ timeGravityAccMag-std       : num  -0.705 -0.954 -0.979 -0.977 -0.977 ...
 $ timeBodyAccJerkMag-mean     : num  -0.93 -0.974 -0.982 -0.983 -0.987 ...
 $ timeBodyAccJerkMag-std      : num  -0.896 -0.941 -0.971 -0.975 -0.989 ...
 $ timeBodyGyroMag-mean        : num  -0.796 -0.898 -0.939 -0.947 -0.957 ...
 $ timeBodyGyroMag-std         : num  -0.762 -0.911 -0.972 -0.97 -0.969 ...
 $ timeBodyGyroJerkMag-mean    : num  -0.925 -0.973 -0.987 -0.989 -0.99 ...
 $ timeBodyGyroJerkMag-std     : num  -0.894 -0.944 -0.984 -0.986 -0.99 ...
 $ freqBodyAcc-mean-X          : num  -0.919 -0.961 -0.992 -0.993 -0.992 ...
 $ freqBodyAcc-mean-Y          : num  -0.918 -0.964 -0.965 -0.968 -0.969 ...
 $ freqBodyAcc-mean-Z          : num  -0.789 -0.957 -0.967 -0.967 -0.98 ...
 $ freqBodyAcc-std-X           : num  -0.948 -0.984 -0.995 -0.996 -0.995 ...
 $ freqBodyAcc-std-Y           : num  -0.925 -0.97 -0.974 -0.977 -0.967 ...
 $ freqBodyAcc-std-Z           : num  -0.636 -0.942 -0.962 -0.969 -0.978 ...
 $ freqBodyAccJerk-mean-X      : num  -0.9 -0.944 -0.991 -0.991 -0.991 ...
 $ freqBodyAccJerk-mean-Y      : num  -0.937 -0.969 -0.973 -0.972 -0.98 ...
 $ freqBodyAccJerk-mean-Z      : num  -0.924 -0.973 -0.972 -0.97 -0.983 ...
 $ freqBodyAccJerk-std-X       : num  -0.924 -0.962 -0.992 -0.992 -0.994 ...
 $ freqBodyAccJerk-std-Y       : num  -0.943 -0.98 -0.971 -0.975 -0.979 ...
 $ freqBodyAccJerk-std-Z       : num  -0.948 -0.981 -0.972 -0.981 -0.989 ...
 $ freqBodyGyro-mean-X         : num  -0.824 -0.923 -0.973 -0.972 -0.976 ...
 $ freqBodyGyro-mean-Y         : num  -0.808 -0.926 -0.981 -0.981 -0.98 ...
 $ freqBodyGyro-mean-Z         : num  -0.918 -0.968 -0.972 -0.967 -0.969 ...
 $ freqBodyGyro-std-X          : num  -0.903 -0.927 -0.973 -0.967 -0.974 ...
 $ freqBodyGyro-std-Y          : num  -0.823 -0.932 -0.977 -0.972 -0.977 ...
 $ freqBodyGyro-std-Z          : num  -0.956 -0.97 -0.979 -0.965 -0.97 ...
 $ freqBodyAccMag-mean         : num  -0.791 -0.954 -0.976 -0.973 -0.978 ...
 $ freqBodyAccMag-std          : num  -0.711 -0.96 -0.984 -0.982 -0.979 ...
 $ freqBodyBodyAccJerkMag-mean : num  -0.895 -0.945 -0.971 -0.972 -0.987 ...
 $ freqBodyBodyAccJerkMag-std  : num  -0.896 -0.934 -0.97 -0.978 -0.99 ...
 $ freqBodyBodyGyroMag-mean    : num  -0.771 -0.924 -0.975 -0.976 -0.977 ...
 $ freqBodyBodyGyroMag-std     : num  -0.797 -0.917 -0.974 -0.971 -0.97 ...
 $ freqBodyBodyGyroJerkMag-mean: num  -0.89 -0.952 -0.986 -0.986 -0.99 ...
 $ freqBodyBodyGyroJerkMag-std : num  -0.907 -0.938 -0.983 -0.986 -0.991 ..
 ```

### Variable Names
From the UCI info: The features selected for this database come from the accelerometer and gyroscope 3-axial raw signals timeAcc-XYZ and timeGyro-XYZ. These time domain signals were captured at a constant rate of 50 Hz. Then they were filtered using a median filter and a 3rd order low pass Butterworth filter with a corner frequency of 20 Hz to remove noise. Similarly, the acceleration signal was then separated into body and gravity acceleration signals (timeBodyAcc-XYZ and timeGravityAcc-XYZ) using another low pass Butterworth filter with a corner frequency of 0.3 Hz.

Subsequently, the body linear acceleration and angular velocity were derived in time to obtain Jerk signals (timeBodyAccJerk-XYZ and timeBodyGyroJerk-XYZ). Also the magnitude of these three-dimensional signals were calculated using the Euclidean norm (timeBodyAccMag, timeGravityAccMag, timeBodyAccJerkMag, timeBodyGyroMag, timeBodyGyroJerkMag).

Finally a Fast Fourier Transform (FFT) was applied to some of these signals producing freqBodyAcc-XYZ, freqBodyAccJerk-XYZ, freqBodyGyro-XYZ, freqBodyAccJerkMag, freqBodyGyroMag, freqBodyGyroJerkMag.

These signals were used to estimate variables of the feature vector for each pattern:
'-X', '-Y', or '-Z' suffix is used to denote 3-axial signals in the X, Y and Z directions.

'-mean' and '-std' is used to denote a mean or standard deviation, respectively.

Additional vectors obtained by averaging the signals in a signal window sample. These are used on the angle() variable:


## Aggregating and Averaging
The second part of the project is to aggregate the observations by activity, for each subject, and then find the average (mean) of each feature.

The aggregation is therefore applied across the "activity" and "subjectId" columns (in that order), with a simple mean computed on each feature.

## Persisting the Results
The tidied observations are written (via write.table()) to *tidydata.txt*, in the working directory of *run_analysis.R*.

The aggregated averages are similarly written to *tidydata_aggAve.txt*, in the same working directory.

